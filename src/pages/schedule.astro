---
import { marked } from "marked";

import { eventListSchema } from "../api";
import Layout from "../layouts/Layout.astro";
import PageContainer from "../components/PageContainer.astro";

const events = await fetch(
  `${import.meta.env.API_SERVER}/api/events?populate=*`
)
  .then((response) => response.json())
  .then((response) => eventListSchema.parse(response.data));
---

<Layout>
  <PageContainer>
    <h1 class="font-bold">Schedule</h1>
    {
      events.map((event) => (
        <>
          <h2>{event.name}</h2>
          <h3>{event.artists.map((artist) => artist.name).join(", ")}</h3>
          <h3>{event.venue.name}</h3>
          <div set:html={marked.parse(event.description)} />
        </>
      ))
    }
  </PageContainer>
</Layout>
