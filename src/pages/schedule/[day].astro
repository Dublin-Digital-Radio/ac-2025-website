---
export function getStaticPaths() {
  return [
    { params: { day: "may-1" } },
    { params: { day: "may-2" } },
    { params: { day: "may-3" } },
    { params: { day: "may-4" } },
  ];
}

import { marked } from "marked";
import qs from "qs";
import { DateTime } from "luxon";

import { eventListSchema } from "../../api";
import Layout from "../../layouts/Layout.astro";
import PageContainer from "../../components/PageContainer.astro";
import DaySelector from "../../components/DaySelector.astro";

const { day } = Astro.params;

const events = await fetch(
  `${import.meta.env.API_SERVER}/api/events?${qs.stringify({
    populate: "*",
    filters: {
      scheduleDay: {
        $eq: day,
      },
    },
  })}`
)
  .then((response) => response.json())
  .then((response) => eventListSchema.parse(response.data));
---

<Layout>
  <PageContainer>
    <h1 class="font-bold">Schedule</h1>
    <DaySelector day={day} />
    {
      events.map((event) => (
        <>
          <h2>{event.name}</h2>
          <h3>{event.artists.map((artist) => artist.name).join(", ")}</h3>
          <h3>{event.venue.name}</h3>
          {event.description ? (
            <div set:html={marked.parse(event.description)} />
          ) : null}
        </>
      ))
    }
  </PageContainer>
</Layout>
