---
export function getStaticPaths() {
  return [
    { params: { day: "2025-05-01" } },
    { params: { day: "2025-05-02" } },
    { params: { day: "2025-05-03" } },
    { params: { day: "2025-05-04" } },
  ];
}

import { marked } from "marked";
import qs from "qs";
import { DateTime } from "luxon";

import { eventListSchema } from "../../api";
import Layout from "../../layouts/Layout.astro";
import PageContainer from "../../components/PageContainer.astro";
import DaySelector from "../../components/DaySelector.astro";

const { day } = Astro.params;

const events = await fetch(
  `${import.meta.env.API_SERVER}/api/events?${qs.stringify({
    populate: "*",
    filters: {
      startsAt: {
        $gte: DateTime.fromISO(day)
          .setZone("Europe/Dublin")
          .startOf("day")
          .toISO(),
      },
      endsAt: {
        $lte: DateTime.fromISO(day)
          .setZone("Europe/Dublin")
          .endOf("day")
          .toISO(),
      },
    },
  })}`
)
  .then((response) => response.json())
  .then((response) => eventListSchema.parse(response.data));
---

<Layout>
  <PageContainer>
    <h1 class="font-bold">Schedule</h1>
    <DaySelector day={day} />
    {
      events.map((event) => (
        <>
          <h2>{event.name}</h2>
          <h3>{event.artists.map((artist) => artist.name).join(", ")}</h3>
          <h3>{event.venue.name}</h3>
          <div set:html={marked.parse(event.description)} />
        </>
      ))
    }
  </PageContainer>
</Layout>
